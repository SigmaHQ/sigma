title: ScreenConnect ZipSlip Exploitation (Feb 2024)
id: 4c198a60-7d05-4daf-8bf7-4136fb6f5c62
status: experimental
description: This detects file modifications to ASPX and ASHX files within the root of the App_Extensions directory, which is allowed by a ZipSlip vulnerability in versions prior to 23.9.8.  This does occur during exploitation of the vulnerability. This requires an Advanced Auditing policy to log a successful Windows Event ID 4663 events and with a SACL set on the directory.
references:
  - https://www.connectwise.com/company/trust/security-bulletins/connectwise-screenconnect-23.9.8
  - https://www.huntress.com/blog/a-catastrophe-for-control-understanding-the-screenconnect-authentication-bypass
author: Matt Anderson, Caleb Stewart, Huntress
date: 2024/02/20
logsource:
  product: windows
  service: security
  definition: 'Requirements: SACLs must be enabled for the directory'
detection:
  selection:
    EventID: 4663
    ObjectType: 'File'
    ProcessName|contains: 'ScreenConnect.Service.exe'
    AccessMask: 0x6
  legitimate_path:
    ObjectName|endswith: 'ScreenConnect\App_Extensions\\*\\*'
  illegitimate_path:
    ObjectName|endswith: 'ScreenConnect\App_Extensions\\*.as?x'
  condition: selection and illegitimate_path and not legitimate_path
falsepositives:
  - Unknown
level: critical
tags:
  - attack.initial_access
  - attack.persistence
