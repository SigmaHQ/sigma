title: Arsenal-237 System Reconnaissance - Environment Variable Discovery
id: a854ce4b-c785-4649-9a69-25e8d2b546ac
status: test
description: Detects suspicious queries for COMPUTERNAME and USERNAME environment
  variables
author: The Hunters Ledger
references:
- https://github.com/The-Hunters-Ledger/Threat-Intel-Reports
date: 2025/01/01
logsource:
  category: process_creation
  product: windows
detection:
  env_discovery:
    CommandLine|contains:
    - GetEnvironmentVariable*COMPUTERNAME
    - GetEnvironmentVariable*USERNAME
    - '%COMPUTERNAME%'
    - '%USERNAME%'
  suspicious_process:
    Image|endswith:
    - rundll32.exe
    - regsvcs.exe
    - powershell.exe
    - cmd.exe
  filter_legitimate:
    CommandLine|contains:
    - echo %COMPUTERNAME%
    - hostname
    - whoami
  condition: env_discovery and suspicious_process and not filter_legitimate
falsepositives:
- System administration scripts
- Legitimate batch files querying environment variables
level: medium
tags:
- attack.discovery
