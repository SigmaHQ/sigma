title: Remote Desktop Enabled or Disabled via WMIC
id: 4b8f6d3a-9c5e-4f2a-a7d8-6b9c3e5f2a8d
status: experimental
description: Detects the use of wmic.exe to enable/disable Remote Desktop Protocol (RDP) connections on a Windows system. The Windows Management Instrumentation Command-line (WMIC) utility can be used to modify system settings, including enabling RDP by setting the AllowTSConnections value to 1. Attackers commonly enable RDP to establish persistence, maintain remote access, or facilitate lateral movement within a compromised network. This technique allows them to connect to the system remotely without physical access.
references:
    - https://www.trendmicro.com/en_gb/research/22/e/uncovering-a-kingminer-botnet-attack-using-trend-micro-managed-x.html
author: "Daniel Koifman (KoifSec)"
date: 2025-10-27
tags:
    - attack.lateral-movement
    - attack.t1021.001
    - attack.execution
    - attack.t1047
logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - Image|endswith: '\wmic.exe'
        - OriginalFileName: 'wmic.exe'
    selection_cli:
        CommandLine|contains|all:
            - 'rdtoggle'
            - 'SetAllowTSConnections'
    condition: all of selection_*
falsepositives:
    - Legitimate system administrators enabling RDP for remote support
    - System configuration scripts during deployment
level: medium
