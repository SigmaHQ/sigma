title: SharePoint CVE-2025-53770 ToolShell Exploitation via IIS Worker Process
id: a7b2c8d4-e5f6-4a1b-9c3d-2e7f8a9b1c4d
status: experimental
description: Detects potential SharePoint exploitation (CVE-2025-53770) using ToolShell technique where IIS worker process (w3wp.exe) spawns cmd.exe which then executes PowerShell with encoded commands. Based on Rapid7 MDR detection patterns for active exploitation of critical RCE vulnerability in Microsoft SharePoint.
author: TristanInSec (Sigma rule), Based on Rapid7 MDR detection guidance
date: 2025-07-23
references:
    - https://www.linkedin.com/posts/jhencinski_rapid7-mdr-is-detecting-active-exploitation-activity-7352685211240783872-EU4p # Detection logic
    - https://msrc.microsoft.com/blog/2025/07/customer-guidance-for-sharepoint-vulnerability-cve-2025-53770/
    - https://research.eye.security/sharepoint-under-siege/
    - https://attack.mitre.org/techniques/T1505/003/ # Web Shell
    - https://attack.mitre.org/techniques/T1059/001/ # PowerShell
    - https://attack.mitre.org/techniques/T1027/010/ # Obfuscated Files or Information: Command Obfuscation
logsource:
    category: process_creation
    product: windows
detection:
    selection_parent:
        ParentImage|endswith: '\w3wp.exe'
        Image|endswith: '\cmd.exe'
    selection_child:
        ParentImage|endswith: '\cmd.exe'
        Image|endswith: '\powershell.exe'
        CommandLine|contains:
            - '-EncodedCommand'
            - '-ENCODEDCOMMAND'
            - '-enc'
            - '-ENC'
            - '-e '
            - '-E '
    condition: selection_parent and selection_child
falsepositives:
    - Legitimate administrative scripts executed through IIS
    - Automated deployment processes
    - Management tools that use IIS worker processes
    - SharePoint Timer Jobs and maintenance tasks
level: medium
tags:
    - attack.execution
    - attack.t1059.001
    - attack.persistence
    - attack.t1505.003
    - attack.t1027.010
